<%-- 
   Copyright 2014 Ntalaperas Dimitrios UBITECH

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
--%>

<%@page contentType="text/html" pageEncoding="UTF-8"%>
<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Semantic Editor</title>
    </head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>    
    <script>
        var endpoint = "http://192.168.1.202:4040/zeincrorep/query";
        var query = "select ?a ?c ?g where {graph ?g { ?a  <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  " +
                "<http://purl.org/linked-data/cube#DataStructureDefinition>. ?a <http://linked2safety-project.eu/DataCube/hasTitle> ?c} }";

        function sparqlQueryJson(queryStr, endpoint, callback, isDebug) {
            var querypart = "query=" + escape(queryStr);

            var xmlhttp = null;
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            } else if (window.ActiveXObject) {
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            } else {
                alert('Perhaps your browser does not support XMLHttpRequests?');
            }

            xmlhttp.open('POST', endpoint, true);
            xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xmlhttp.setRequestHeader("Accept", "application/sparql-results+json");

            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4) {
                    if (xmlhttp.status == 200) {
                        // Do something with the results
                        if (isDebug)
                            alert(xmlhttp.responseText);
                        callback(xmlhttp.responseText);
                    } else {
                        alert("Sparql query error: " + xmlhttp.status + " "
                                + xmlhttp.responseText);
                    }
                }
            };

            xmlhttp.send(querypart);

        }
        ;
        function sparqlUpdateJson(queryStr, endpoint, callback, isDebug) {
            var querypart = "update=" + escape(queryStr);

            var xmlhttp = null;
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            } else if (window.ActiveXObject) {

                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            } else {
                alert('Perhaps your browser does not support XMLHttpRequests?');
            }

            xmlhttp.open('POST', endpoint, false);
            xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xmlhttp.setRequestHeader("Accept", "application/sparql-results+json");

            xmlhttp.send(querypart);
            callback(xmlhttp.responseText);

        }
        ;
    </script>

    <script>

        var cubeIds = [];

        function cubeSelected()
        {
            document.getElementById("TopLevelCommentArea").value = "";
            document.getElementById("cubeTitleArea").value = "";
            document.getElementById("cubeDescriptionTitleArea").value = "";
            document.getElementById("cubeProviderTitleArea").value = "";
            document.getElementById("cubeCreatorArea").value = "";
            document.getElementById("cubestudyProjectTitleArea").value = "";
            document.getElementById("cubeStudyProjectDescriptionArea").value = "";
            document.getElementById("cubeStudyProjectSponsorArea").value = "";
            document.getElementById("cubeStudyClinicalSiteArea").value = "";
            document.getElementById("cubesStudyProjectCoordinatorArea").value = "";

            document.getElementById("variablesDiv").innerHTML = "";

            for (var i = 0; i < 37; i++) {
                document.getElementById("ch_" + i).checked = false;
            }
            var e = document.getElementById("cubeSelectControl");
            var cubeId = e.options[e.selectedIndex].value;
            var graphId = e.options[e.selectedIndex].id;
            //alert(graphId);
            //alert(cubeId);
            var studyPropertiesQuery = "select  ?c where {graph ?g {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>   ?c } }";
            sparqlQueryJson(studyPropertiesQuery, endpoint, fillProperitesCallback, false);

            var annotQuery = "select  ?c from <" + graphId + "> where { <" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProject>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillStudyProjectCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasDescription>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillDescriptionCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasCreator>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillCreatorCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasTitle>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillTitleCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectDescription>  ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillProjectDescriptionCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyClincalSiteArea>    ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillStudyClinicalCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectSponsor>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillStudySponsorCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasProvider>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillStudyProviderCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectCoordinatorArea>   ?c }";
            sparqlQueryJson(annotQuery, endpoint, fillStudyProjecCoordinatortCallback, false);
            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasComment>   ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillCommentCallback, false);

            annotQuery = "select ?a  ?c from <" + graphId + "> ";
            annotQuery += "where { <" + cubeId + "> <http://purl.org/linked-data/cube#component> ?a. ";
            annotQuery += "?a <http://purl.org/linked-data/cube#dimension> ?c }";
            sparqlQueryJson(annotQuery, endpoint, fillDimensionCallBack, false);

            annotQuery = "select ?a  ?c ?d from <" + graphId + "> ";
            annotQuery += "where { <" + cubeId + "> <http://purl.org/linked-data/cube#component> ?a. ";
            annotQuery += "?a <http://purl.org/linked-data/cube#dimension> ?c. ";
            annotQuery += " ?a  <http://linked2safety-project.eu/DataCube/variableComment> ?d }";
            sparqlQueryJson(annotQuery, endpoint, fillDimensionValuesCallBack, false);

            annotQuery = "select  ?c from <" + graphId + "> where  {<" + cubeId + "> <http://www.w3.org/1999/02/22-rdf-syntax-ns#seeAlso> ?c  }";
            sparqlQueryJson(annotQuery, endpoint, fillConceptsListCallBack, false);
        }

        function fillConceptsListCallBack(str) {
            var jsonObj = eval('(' + str + ')');
            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                var conceptId = jsonObj.results.bindings[i].c.value;
                document.getElementsByName(conceptId)[0].checked = true;
            }
        }

        var varIdsList = [];
        function fillDimensionValuesCallBack(str) {
            var jsonObj = eval('(' + str + ')');
            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                var varId = jsonObj.results.bindings[i].a.value;
                if (jsonObj.results.bindings[i].d.value == "Diagnosed") {
                    document.getElementById(varId).value = "2";
                } else if (jsonObj.results.bindings[i].d.value == "Self Reported") {
                    document.getElementById(varId).value = "1";
                }
            }
            //alert(varIdsList);
        }

        function fillDimensionCallBack(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                var varTokens = jsonObj.results.bindings[i].c.value.split("/");
                var varName = varTokens[varTokens.length - 1];
                var varId = jsonObj.results.bindings[i].a.value;
                varIdsList.push(varId);
                //alert(varId);
                document.getElementById("variablesDiv").innerHTML += varName + ": <select id=\"" + varId + "\"><option value=\"0\">N/A</option><option value=\"1\">Self Reported</option><option value=\"2\">Diagnosed</option></select><br/>";
            }
        }

        function fillDescriptionCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeDescriptionTitleArea").value = propertyStr;
            }
        }
        function fillStudyProjectCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubestudyProjectTitleArea").value = propertyStr;
            }
        }
        function fillCreatorCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeCreatorArea").value = propertyStr;
            }
        }
        function fillTitleCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeTitleArea").value = propertyStr;
            }
        }
        function fillProjectDescriptionCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeStudyProjectDescriptionArea").value = propertyStr;
            }
        }
        function fillStudyClinicalCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeStudyClinicalSiteArea").value = propertyStr;
            }
        }
        function fillStudySponsorCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeStudyProjectSponsorArea").value = propertyStr;
            }
        }
        function fillStudyProviderCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubeProviderTitleArea").value = propertyStr;
            }
        }
        function fillStudyProjecCoordinatortCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("cubesStudyProjectCoordinatorArea").value = propertyStr;
            }
        }
        function fillCommentCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                document.getElementById("TopLevelCommentArea").value = propertyStr;
            }
        }
        function fillProperitesCallback(str) {
            var jsonObj = eval('(' + str + ')');

            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //alert(jsonObj.results.bindings[i].c.value);
                var propertyTokens = jsonObj.results.bindings[i].c.value.split("/");
                var propertyStr = propertyTokens[propertyTokens.length - 1];
                //alert (propertyStr);
                if (propertyStr == "doubleBlind") {
                    document.getElementById("doubleBlindChkBox").checked = true;
                } else if (propertyStr == "multicenter") {
                    document.getElementById("multiCenterChkBox").checked = true;
                } else if (propertyStr == "randomized") {
                    document.getElementById("randomizedChkBox").checked = true;
                } else if (propertyStr == "doubleDummy") {
                    document.getElementById("doubleDummyChkBox").checked = true;
                } else if (propertyStr == "crossOver") {
                    document.getElementById("crossOverChkBox").checked = true;
                } else if (propertyStr == "singleDose") {
                    document.getElementById("singleDoseChkBox").checked = true;
                }
            }
        }
        // Define a callback function to receive the SPARQL JSON result.
        function myCallback(str) {
            // Convert result to JSON
            var jsonObj = eval('(' + str + ')');

            // Build up a table of results.
            //var result = " <table border='2' cellpadding='9'>" ;
            var result = "";
            var cubeGraphs = [];
            for (var i = 0; i < jsonObj.results.bindings.length; i++) {
                //if (jsonObj.results.bindings[i].b.value == "http://www.w3.org/1999/02/22-rdf-syntax-ns#type" 
                //        && jsonObj.results.bindings[i].c.value == "http://purl.org/linked-data/cube#DataStructureDefinition") {
                //    result+="cube definition";
                cubeIds.push(jsonObj.results.bindings[i].a.value);
                cubeGraphs.push(jsonObj.results.bindings[i].g.value);
                //}
                /*result += " <tr> <td>" + jsonObj.results.bindings[i].a.value;
                 result += " </td><td>" + jsonObj.results.bindings[i].b.value;
                 result += " </td><td>" + jsonObj.results.bindings[i].c.value;
                 result += " </td></tr>";*/
            }
            //result += "</table>" ;

            var selectQubeDiv = "<select id=\"cubeSelectControl\" onchange = \"cubeSelected();\">\n";
            selectQubeDiv += "<option value = \"-1\">Select cube</option>";
            for (var i = 0; i < cubeIds.length; i++) {
                //alert(i);
                selectQubeDiv += "\t<option value=\"" + cubeIds[i] + "\" id=\"" + cubeGraphs[i] + "\"> Data Cube " + (i + 1) + ": " + jsonObj.results.bindings[i].c.value + "</option>\n";
                result = selectQubeDiv;
            }
            selectQubeDiv += "</select>";
            document.getElementById("selectDataCube").innerHTML = selectQubeDiv;
            //alert(result);
        }
        // Make the query.
        sparqlQueryJson(query, endpoint, myCallback, false);

        function dummyCallBack(str) {

        }
        var updateEndpoint = "http://192.168.1.202:4040/zeincrorep/update";
        function editData() {
            document.getElementById("waitIdDiv").style.display = "block";
            var e = document.getElementById("cubeSelectControl");
            var cubeId = e.options[e.selectedIndex].value;
            var graphId = e.options[e.selectedIndex].id;

            var updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectSponsor> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectSponsor> \"" + document.getElementById("cubeStudyProjectSponsorArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasDescription> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasDescription> \"" + document.getElementById("cubeDescriptionTitleArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasCreator> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasCreator> \"" + document.getElementById("cubeCreatorArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasComment> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasComment> \"" + document.getElementById("TopLevelCommentArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasTitle> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasTitle> \"" + document.getElementById("cubeTitleArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProject> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProject> \"" + document.getElementById("cubestudyProjectTitleArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasProvider> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasProvider> \"" + document.getElementById("cubeProviderTitleArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasCreator> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasCreator> \"" + document.getElementById("cubeCreatorArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectDescription> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectDescription> \"" + document.getElementById("cubeStudyProjectDescriptionArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyClincalSiteArea> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyClincalSiteArea> \"" + document.getElementById("cubeStudyClinicalSiteArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectCoordinatorArea> ?c} \n";
            updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProjectCoordinatorArea> \"" + document.getElementById("cubesStudyProjectCoordinatorArea").value + "\"} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties> ?c} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            if (document.getElementById("multiCenterChkBox").checked) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>  <http://linked2safety-project.eu/studyProperty/multicenter> }\n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            }
            if (document.getElementById("randomizedChkBox").checked) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>  <http://linked2safety-project.eu/studyProperty/randomized> }\n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            }
            if (document.getElementById("doubleBlindChkBox").checked) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>  <http://linked2safety-project.eu/studyProperty/doubleBlind> }\n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            }
            if (document.getElementById("doubleDummyChkBox").checked) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>  <http://linked2safety-project.eu/studyProperty/doubleDummy> }\n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            }
            if (document.getElementById("crossOverChkBox").checked) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>  <http://linked2safety-project.eu/studyProperty/crossOver> }\n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            }
            if (document.getElementById("singleDoseChkBox").checked) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "INSERT  {<" + cubeId + "> <http://linked2safety-project.eu/DataCube/hasStudyProperties>  <http://linked2safety-project.eu/studyProperty/singleDose> }\n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
            }


            for (var i = 0; i < varIdsList.length; i++) {
                updateQuery = "WITH <" + graphId + "> \n";
                updateQuery += "DELETE  {<" + varIdsList[i] + "> <http://linked2safety-project.eu/DataCube/variableComment>  ?c} \n";
                updateQuery += "WHERE {?a ?b ?c}";
                sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
                if (document.getElementById(varIdsList[i]).value == "1") {
                    updateQuery = "WITH <" + graphId + "> \n";
                    updateQuery += "INSERT  {<" + varIdsList[i] + "> <http://linked2safety-project.eu/DataCube/variableComment> \"Self Reported\" }\n";
                    updateQuery += "WHERE {?a ?b ?c}";
                    sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
                } else if (document.getElementById(varIdsList[i]).value == "2") {
                    updateQuery = "WITH <" + graphId + "> \n";
                    updateQuery += "INSERT  {<" + varIdsList[i] + "> <http://linked2safety-project.eu/DataCube/variableComment> \"Diagnosed\" }\n";
                    updateQuery += "WHERE {?a ?b ?c}";
                    sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
                }
                //alert(document.getElementById(varIdsList[i]).value )
            }

            updateQuery = "WITH <" + graphId + "> \n";
            updateQuery += "DELETE  {<" + cubeId + "> <http://www.w3.org/1999/02/22-rdf-syntax-ns#seeAlso> ?c} \n";
            updateQuery += "WHERE {?a ?b ?c}";
            sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);

            for (var i = 0; i < 37; i++) {
                //alert(document.getElementById("ch_"+i).name)
                if (document.getElementById("ch_" + i).checked) {
                    updateQuery = "WITH <" + graphId + "> \n";
                    updateQuery += "INSERT  {<" + cubeId + "><http://www.w3.org/1999/02/22-rdf-syntax-ns#seeAlso> <" + document.getElementById("ch_" + i).name + "> }\n";
                    updateQuery += "WHERE {?a ?b ?c}";
                    sparqlUpdateJson(updateQuery, updateEndpoint, dummyCallBack, false);
                }

            }
            document.getElementById("waitIdDiv").style.display = "none";
            location.reload();
        }


        function deleteCube() {
            var selectControl = document.getElementById("cubeSelectControl");
            //alert(selectControl.options[selectControl.selectedIndex].id);
            var deleteQuery = "CLEAR GRAPH <" + selectControl.options[selectControl.selectedIndex].id + ">";
            if (confirm("This will remove the Data Cube and all its contents from the tripple store. Are you sure you wish to proceed?")) {
                sparqlUpdateJson(deleteQuery, updateEndpoint, dummyCallBack, false);
            }
            //location.reload();
        }

    </script>
    <body>

        <div id="selectDataCube"></div>&nbsp;<button id="deleteCubeButton" onclick="deleteCube();">Delete Selected Cube</button>
        <br/>
        <div id="waitIdDiv" style="display:none">Annotations sent. Please wait...</div>
        <table>
            <tr>
                <td>
                    <div id="topAnnotationsDiv">
                        <table>
                            <tr>
                                <td colspan ="2" style="border:0px">
                            <u>Top level annotations:</u>
                            </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Comment:
                                </td>
                                <td style="border:0px">
                                    <textarea id="TopLevelCommentArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Title:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeTitleArea"></textarea>
                                </td>
                            </tr>                            
                            <tr>
                                <td style="border:0px">
                                    Description:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeDescriptionTitleArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Provider:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeProviderTitleArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Creator:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeCreatorArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Study Project Title:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubestudyProjectTitleArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Study Project Description:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeStudyProjectDescriptionArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Study Project Sponsor:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeStudyProjectSponsorArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Study Clinical Site:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubeStudyClinicalSiteArea"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td style="border:0px">
                                    Study Project Coordinator:
                                </td>
                                <td style="border:0px">
                                    <textarea id="cubesStudyProjectCoordinatorArea"></textarea>
                                </td>
                            </tr>    
                        </table>
                    </div>
                </td>

                <td>
                    <div id="conceptsDiv">
                        <ul id="browser" class="filetree" style="height:500px;overflow-y:auto">
                            <li><span class="folder">Non Infectious Disease</span>
                                <ul>
                                    <li><span class="folder">AllergyImmunologyRheumatology &nbsp;<input type="checkbox" id="ch_0" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#AllergyImmunologyRheumatology' onclick='handleCheckBoxClick(this);'></span></li>

                                </ul>
                                <ul>
                                    <li><span class="folder">CardiovascularDiseases &nbsp;<input type="checkbox" id="ch_1" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#CardiovascularDiseases' onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">CoronaryHeartDisease &nbsp;<input type="checkbox" id="ch_2" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#CoronaryHeartDisease' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Stroke &nbsp;<input type="checkbox" id="ch_3" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#Stroke' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Hypertension &nbsp;<input type="checkbox" id="ch_4"  name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#Hypertension' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">MyocardialInfarction &nbsp;<input type="checkbox" id="ch_5" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#MyocardialInfarction' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul>
                                    </li>
                                </ul>
                                <ul>
                                    <li><span class="folder">Dermatology &nbsp;<input type="checkbox" id="ch_6" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#Dermatology' onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">SkinProblemNOS &nbsp;<input type="checkbox" id="ch_7" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#SkinProblemNOS' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul> 
                                    </li>
                                </ul>    
                                <ul>
                                    <li><span class="folder">EndocrinologyAndMetabolism &nbsp;<input type="checkbox" id="ch_8" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#EndocrinologyAndMetabolism' onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">MetabolicSyndrome &nbsp;<input type="checkbox" id="ch_9" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#MetabolicSyndrome' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Obesity &nbsp;<input type="checkbox" id="ch_10" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#Obesity' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">ThyroidAndOtherHormonalProblems &nbsp;<input type="checkbox" id="ch_11" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#ThyroidAndOtherHormonalProblems'onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Diabetes &nbsp;<input type="checkbox" id="ch_12" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#Diabetes' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Dyslipidemia &nbsp;<input type="checkbox" id="ch_13" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#Dyslipidemia' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul>  
                                    </li>
                                </ul>                                     
                                <ul>
                                    <li><span class="folder">GastrointestinalDiseases &nbsp;<input type="checkbox" id="ch_14" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#GastrointestinalDiseases' onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">DigestiveProblems &nbsp;<input type="checkbox" id="ch_15" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#DigestiveProblems' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul>                                                      
                                    </li>
                                </ul>

                                <ul>
                                    <li><span class="folder">HematologyAndOncology &nbsp;<input type="checkbox" id="ch_16" name="http://hcls.deri.ie/l2s/sehr/chuv/1.0#HematologyAndOncology" onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">Cancer &nbsp;<input type="checkbox" id="ch_17" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#Cancer' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul>                                                          
                                    </li>

                                </ul>
                                <ul>
                                    <li><span class="folder">Neurology &nbsp;<input type="checkbox" id="ch_18" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#Neurology' onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">PerceptiveDisorders &nbsp;<input type="checkbox" id="ch_19" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#PerceptiveDisorders' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">ParkinsonsDisease &nbsp;<input type="checkbox" id="ch_20" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#ParkinsonsDisease' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Epilepsy &nbsp;<input type="checkbox" id="ch_21" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#Epilepsy' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">HuntingtonsDisease &nbsp;<input type="checkbox" id="ch_22" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#HuntingtonsDisease' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">MigraineCumulative &nbsp;<input type="checkbox" id="ch_23" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#MigraineCumulative' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">MultipleSclerosis &nbsp;<input type="checkbox" id="ch_24" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#MultipleSclerosis' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul>                                                     
                                    </li>
                                </ul>
                                <ul>
                                    <li><span class="folder">PsychiatricDisorders &nbsp;<input type="checkbox" id="ch_25" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#PsychiatricDisorders' onclick='handleCheckBoxClick(this);'></span>
                                        <ul>
                                            <li><span class="folder">SuicideAttemps &nbsp;<input type="checkbox" id="ch_26" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#SuicideAttemps' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">Depression &nbsp;<input type="checkbox" id="ch_27" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#Depression' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">SchizotypalPersonalityDisorder &nbsp;<input type="checkbox" id="ch_28" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#SchizotypalPersonalityDisorder' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">AnxietyDisorders &nbsp;<input type="checkbox" id="ch_29" name='http://hcls.deri.ie/l2s/chuv/1.0#AnxietyDisorders' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">ChildhoodDisorders &nbsp;<input type="checkbox" id="ch_30" name='http://hcls.deri.ie/l2s/chuv/1.0#ChildhoodDisorders' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">EatingDisorders &nbsp;<input type="checkbox" id="ch_31" name='http://hcls.deri.ie/l2s/chuv/1.0#EatingDisorders' onclick='handleCheckBoxClick(this);'></span></li>
                                            <li><span class="folder">ImpulseControlDisorders &nbsp;<input type="checkbox" id="ch_32" name='http://hcls.deri.ie/l2s/chuv/1.0#ImpulseControlDisorders' onclick='handleCheckBoxClick(this);'></span></li>
                                        </ul>                                                         
                                    </li>
                                </ul>
                                <ul>
                                    <li><span class="folder">RenalDisease &nbsp;<input type="checkbox" id="ch_33" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#RenalDisease' onclick='handleCheckBoxClick(this);'></span></li>
                                </ul>
                                <ul>
                                    <li><span class="folder">RespiratoryDiseases &nbsp;<input type="checkbox" id="ch_34" name='http://hcls.deri.ie/l2s/sehr/chuv/1.0#RespiratoryDiseases' onclick='handleCheckBoxClick(this);'></span></li>
                                </ul>
                                <ul>
                                    <li><span class="folder">OphthalmologicalProblems &nbsp;<input type="checkbox" id="ch_35" name='http://hcls.deri.ie/l2s/sehr/commonVariables/1.0#OphthalmologicalProblems' onclick='handleCheckBoxClick(this);'></span></li>
                                </ul> 
                                <ul>
                                    <li><span class="folder">Anemia &nbsp;<input type="checkbox" id="ch_36" name='http://www.ifomis.org/acgt/1.0#Anemia' onclick='handleCheckBoxClick(this);'></span></li>
                                </ul>                                               
                            </li>
                        </ul>                    
                    </div>                
                </td>
            <tr>
                <td>
                    <div id="studyPropertiesDiv">
                        <br/>
                        <b>Study Properties:</b>
                        <br/>
                        Multi Center <input type="checkbox" id="multiCenterChkBox" >
                        <br/>
                        Randomized   <input type="checkbox" id="randomizedChkBox" >
                        <br/>
                        Double Blind <input type="checkbox" id="doubleBlindChkBox" >
                        <br/>
                        Double Dummy <input type="checkbox" id="doubleDummyChkBox" >
                        <br/>
                        Cross Over   <input type="checkbox" id="crossOverChkBox" >
                        <br/>
                        Single Dose  <input type="checkbox" id="singleDoseChkBox" >
                    </div>                

                </td>
                <td>
                    <div id="variablesDiv">

                    </div>
                </td>
            </tr>
        </table>
        <br/>
        <button id="SubmitAnnotationsBtn">Submit Annotations</button>
        <div id="results">
            <textarea id="resultsArea"></textarea>
        </div>
        <script>
            document.getElementById('SubmitAnnotationsBtn').addEventListener('click', editData, false);
        </script>        
    </body>
</html>
